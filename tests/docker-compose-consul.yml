version: '2'
services:
  consul:
    image: consul
    ports:
      - "8400:8400"
      - "8500:8500"
      - "8600:8600"
      - "8600:8600/udp"
    volumes:
      - .:/data

  jenkins:
    image: odavid/my-bloody-jenkins
    ports:
      - "8080:8080"
      - "50000:50000"
    volumes:
      - .:/data
      - ${TESTS_CONF_DIR}:/confdir
    links:
      - consul
    environment:
      JENKINS_ENV_ADMIN_USER: admin
      JENKINS_ENV_CONFIG_YML_URL: file:///confdir/config.yml
      JENKINS_ENV_CONFIG_YML_URL_POLLING: '5'
      CONSUL_ADDR: consul:8500
      ENVCONSUL_CONSUL_PREFIX: jenkins

